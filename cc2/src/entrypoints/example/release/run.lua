function readFile(a)local b=fs.open(a,"r")if not b then error("Could not open file: "..a)end;local c=b.readAll()b.close()return c end;function deleteDirectory(a)if not fs.exists(a)then return end;if not fs.isDir(a)then fs.delete(a)return end;for d,e in ipairs(fs.list(a))do deleteDirectory(fs.combine(a,e))end;fs.delete(a)end;function copyDirectory(f,g)if not fs.exists(f)or not fs.isDir(f)then error("Source directory does not exist or is not a directory: "..f)end;if not fs.exists(g)then fs.makeDir(g)end;for d,e in ipairs(fs.list(f))do local h=fs.combine(f,e)local i=fs.combine(g,e)if fs.isDir(h)then copyDirectory(h,i)else if fs.exists(i)then fs.delete(i)end;fs.copy(h,i)end end end;function moveDirectory(f,g)copyDirectory(f,g)deleteDirectory(f)end;info=textutils.unserializeJSON(readFile("info.json"))appName=info.name or"Application"lifetime=info.lifetime or{}function rollback()deleteDirectory("app")moveDirectory("old","app")end;function run()local j=0;while true do j=j+1;print(appName.." Starting...")local k,l=pcall(function()shell.run("app/main.lua","run")end)print(appName.." Terminated")if k then return else print("Critical Error:")print(l)end;local m=fs.exists("old")if m then print("Backup EXISTS")end;if lifetime.onCrash=="ROLLBACK"and m then print("Rolling back to the previous version...")rollback()os.sleep(lifetime.restartDelaySeconds or 1)elseif lifetime.onCrash=="ROLLBACK"or lifetime.onCrash=="RESTART"then print("Restarting...")os.sleep(lifetime.restartDelaySeconds or 1)elseif lifetime.onCrash=="TERMINATE"then print("Terminating Wrapper...")return else error("Unknown crash strategy: "..lifetime.onCrash)end;print("Crash Number: "..j)end end;run()